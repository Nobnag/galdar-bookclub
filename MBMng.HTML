<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>galdar_MemberMnagement</title>
    <script src="https://code.jquery.com/jquery-1.12.4.min.js" integrity="sha256-ZosEbRLbNQzLpnKIkEdrPv7lOy9C27hHQ+Xp8a4MxAQ=" crossorigin="anonymous"></script>
    <link rel="stylesheet" type="text/css" href="css/gnb.css" />
    <script src="js/gnb.js"></script>
    <script type="text/javascript" src="js/validation.js"></script>
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.4.0/css/font-awesome.min.css">
    <link rel="stylesheet" type="text/css" href="css/MBMng.css" />
    <style>
    </style>
</head>
<body>
    <div id="wrapper">
        <div class="info_table">
            <h1>
                회원정보
            </h1>
<!-- 멘토님이 알려주신방식 템플릿 테크 사용 -->
            <template id="template_member_info_row">
                <tr data-memberidx="{MemberIdx}">
                    <td class="data_MemberIdx">{MemberIdx}</td>
                    <td>{Email}</td>
                    <td>{Pw}</td>
                    <td>{Nickname}</td>
                    <td>{Contact}</td>
                    <td>{JoinDatetime}</td>
                    <td>{PremiumMemberYn}</td>
                    <td>{AdminYn}</td>
                </tr>
            </template>
            <!-- 멘토님이 알려주신방식 템플릿 테크 사용 -->
            <table class="mamber_info">
                <thead>
                    <tr>
                        <th>회원번호</th>
                        <th>회원이메일</th>
                        <th>비밀번호</th>
                        <th>닉네임</th>
                        <th>연락처</th>
                        <th>가입일</th>
                        <th>유료가입현황</th>
                        <th>관리자권한</th>
                    </tr>
                </thead>
                <tbody>
                    <!-- 템플릿넣을자리 -->
                    <!-- 노가 하던 방식 
                        <tbody class="mamber_info" style="display:none">
                        <tr>
                            <td>{MemberIdx}</td>
                            <td>{Email}</td>
                            <td>{Pw}</td>
                            <td>{Nickname}</td>
                            <td>{Contact}</td>
                            <td>{JoinDatetime}</td>
                            <td>{PremiumMemberYn}</td>
                            <td>{AdminYn}</td>
                        </tr>
                        </tbody> -->
                </tbody>
            </table>
        <div class="btn_container">
            <button  class="btn_member_update">회원정보수정</button>
            <button class="btn_member_delete">회원탈퇴</button>
        </div>        
    </div>

    <div id="rp_wrapper">
        <!-- 템플릿 넣을자리 -->
    </div>
<!-- 넣을 템플릿 -->
    <template id="template_Nickname">
    <h1>{Nickname}</h1>
    <div class="member_use_contents">
        <div class="SRContent">
            <h2>작성한 한줄평</h2>
            <ul class="SR">
            </ul>
        </div>
        <div class="MRContent">
            <h2>작성한 줄글서평</h2>
            <ul class="MR">
            </ul>
        </div>
    </div>
    </template>
<!-- 넣을 템플릿 -->
    <template id="template_SR">
        <li>
            {SRBookTitle}
            <p>{SRContent}</p>
        </li>
    </template>
    <template id="template_MR">
        <li>
            {MRBookTitle}
            <p>{MRContent}</p>
        </li>
    </template>

    <script>
        //테이블의 특정 인원을 클릭했을때 특정인원의 
        //닉네임과 작성한 한줄글 한줄평을 추가한다 html형식으로
        $(document).on("click",".mamber_info tbody tr",function(){
            var MemberIdx = $(this).data("memberidx");
            //해당 줄의 닉네임을 가저온다
            $.ajax({
                url: '/api/getNickname',
                type: 'get',
                datatype: 'json',
                data : {
                    MemberIdx:MemberIdx
                },
                success: function(result){
                        var nt = result.recordset[0]
                        var html = $("#template_Nickname").html()
                        .replace("{Nickname}",nt.Nickname)
                        $('#rp_wrapper').html(html);
                        for(var i = 0; i < result.recordsets[1].length; i ++) {
                            var srtp = result.recordsets[1][i];
                            var html = $("#template_SR").html()
                            .replace("{SRBookTitle}",srtp.SRBookTitle)
                            .replace("{SRContent}",srtp.SRContent)
                            $('#rp_wrapper .SRContent .SR').append(html);
                        };

                        for(var i = 0; i < result.recordsets[2].length; i ++) {
                            var srtp = result.recordsets[2][i];
                            var html = $("#template_MR").html()
                            .replace("{MRBookTitle}",srtp.MRBookTitle)
                            .replace("{MRContent}",srtp.MRContent)
                            $('#rp_wrapper .MRContent .MR').append(html);
                        };
                },
            });
        });
        //해당회원이 작성한 리뷰와 책IDX를 가저오는 함수
        // function getSR() {
        //     $.ajax({
        //         url: '/api/get_Nickname_SR',
        //         type: 'get',
        //         datatype: 'json',
        //         data : {
        //             MemberIdx:rp
        //         },
        //         success: function(result){
        //             for(var i = 0; i < result.recordset.length; i ++) {
        //                 var sr= result.recordset[i];
        //                 var html = $(".SRContent").html()
        //                 .replace("{SRContent}",sr.SRContent)
        //                 $('#rp_wrapper').html(html);
        //             }
        //         },
        //     });
        // }

//맴버 정보를 불러온다.

        $(document).ready(function(){
            $.ajax({
                url: '/api/getmember_info',
                type: 'get',
                datatype: 'json',
                // async: false,
                success: function(result){
                    for(var i = 0; i < result.recordset.length; i ++){
                        var row = result.recordset[i];
                        // var html = $('.mamber_info').html()
                        // .replace("{MemberIdx}",row.MemberIdx)
                        var html = $("#template_member_info_row").html()
                        //모든 {MemberIdx}를 바꾼다는 뜻 ie까지 연동
                            .replace(/{MemberIdx}/gi, row.MemberIdx)
                            .replace("{Email}",row.Email)
                            .replace("{Pw}",row.Pw)
                            .replace("{Nickname}",row.Nickname)
                            .replace("{Contact}",row.Contact)
                            .replace("{JoinDatetime}",row.JoinDatetime)
                            .replace("{PremiumMemberYn}",row.PremiumMemberYn)
                            .replace("{AdminYn}",row.AdminYn);
                        $('.info_table table tbody').append(html);
                    }
                },
                error: function(jqXHR, textStatus, errorThrown){
                    console.log(errorThrown);
                    alert("an error occured");
                }
            });
        });
    </script>
</body>
</html>