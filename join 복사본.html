<!DOCTYPE html>
<html>
<head>
    <script src="https://code.jquery.com/jquery-1.12.4.min.js" integrity="sha256-ZosEbRLbNQzLpnKIkEdrPv7lOy9C27hHQ+Xp8a4MxAQ=" crossorigin="anonymous"></script>
    <link rel="stylesheet" type="text/css" href="css/gnb.css" />
    <script src="js/gnb.js"></script>
    
    <script>
        /*
        아이디의 유효성을 검증한다. 
        정책: 
        - 길이 4자 이상, 20자 이하
        - 영문 소문자, 숫자, 하이픈, 언더바 입력 가능
        */
        function validation_id(id){
            var reg_id = /^[a-z0-9_-]{4,20}$/;
            if(reg_id.test(id) == false){
                alert("아이디는 4자리 이상, 20자리 이하로 입력 가능합니다. 또한 영문 소문자, 숫자, -(하이픈), _(언더바)만 입력 가능합니다.");
                return false;
            }
            else{
                return true;
            }
        }

        var chkIdDup = function(){
            //입력한 아이디를 가져온다.
            var id = $('input[name="id"]').val().trim();

            /*
                id validation 
                - 아이디가 입력되었는지 확인하고, 
                  입력하지 않았다면 고객에게 안내한다.
                - 아이디의 제한사항에 대해서 체크한다.

            */
            if(id == ""){
                alert("아이디를 입력해주세요.");
                return false;
            }

            var valid_id_result = validation_id(id);
            if(valid_id_result == false){
                return false;
            }

            //API호출: 이 아이디가 사용 가능한 아이디인지 확인한다.
            //확인 결과에 따라 고객에게 안내한다.
            var resp = {
                'result':'true'
            };

            if(resp.result == "true"){
                return true;
            }
            else if(resp.result == "duplicate"){
                alert("이미 사용중인 아이디입니다.");
                return false;
            }
            else{
                alert("오류가 발생했습니다. 관리자에게 문의해주세요.");
                return false;
            }
        }
        

        /*
            아이디 중복검사 버튼을 클릭했을때 실행되는 로직
        */
        $(document).on("click", ".btn_id_dup", function(){
            var result = chkIdDup();
            if(result == true){
                alert("회원 가입 가능한 아이디입니다.");
            }
        });

        $(document).on("click", ".btn_join", function(){
            //1. 값을 가져온다. (아이디, 비밀번호, 비밀번호 확인, 이름)
            var id = $('input[name="id"]').val().trim();
            var pw = $('input[name="pw"]').val().trim();
            var pw_confirm = $('input[name="pw_confirm"]').val().trim();
            var name = $('input[name="name"]').val().trim();
            
            //2. 값에 대한 유효성을 검증한다.
            //2.1. 아이디에 대한 유효성 검사(정규 표현식을 이용)를 수행한다.
            var result = validation_id(id);
            if(result == false){
                return false;
            }
            
            //2.2. 아이디 중복검사를 수행한다.
            var result = chkIdDup();
            if(result == false){
                return false;
            }

            //2.3. 비밀번호 유효성을 검사(정규 표현식을 이용)한다. (6자리 이상, 20자리 이하, 영문/숫자 혼합)
             var reg_pwd = /^.*(?=.{6,20})(?=.*[0-9])(?=.*[a-zA-Z]).*$/;
            if(reg_pwd.test(pw) == false){
                alert("비밀번호는 6자리 이상, 20자리 이하, 영문/숫자 혼합으로 입력이 필요합니다.");
                return false;
            }

            //2.4. 비밀번호와 비밀번호 확인이 동일한지 체크한다.
            if(pw != pw_confirm){
                alert("비밀번호와 비밀번호 확인을 동일하게 입력해주세요.");
                return false;
            }

            //2.5. 이름의 글자수를 체크한다. (1자리 이상 100자리 이하)
            if(!(name.length >= 1 && name.length <= 100)){
                alert("이름을 1자리 이상, 100자리 이하로 입력해주세요.");
                return false;
            }

            //3. 회원가입을 처리한다.
            var req = {
                id: id,
                pw: pw,
                pw_confirm: pw_confirm,
                name: name
            };
            
                //API 호출 (회원가입 처리 요청)
            var resp = {
                result: true,
                msg: '회원 가입이 완료되었습니다.'
            }

            if(resp.result == true){
                alert('회원 가입이 완료되었습니다.');
                location.href = "./index.html";
            }
            else{
                alert(resp.msg);
            }
        });
    </script>
</head>
<body>
    <h1>
        회원가입
    </h1>
    <div class="page page_join">
        <div class="f_msg">아이디: </div><input type="text" name="id"><button class="btn_id_dup">중복검사</button><br>
        <div class="f_msg">비밀번호: </div><input type="password" name="pw"><br>
        <div class="f_msg">비밀번호 확인: </div><input type="password" name="pw_confirm"><br>
        <div class="f_msg">이름: </div><input type="text" name="name"><br>
        <button type="text" class="btn_join">회원가입</button><br>
        
    </div>
</body>
</html>